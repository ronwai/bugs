## Proof-of-concept for CVE-2020-9971 affecting macOS & iOS

Detailed write-up found here: https://xlab.tencent.com/en/2021/01/11/cve-2020-9971-abusing-xpc-service-to-elevate-privilege/

TL;DR - `launchd` subsystem 3, routine 800 (xpc_add_bundles_for_domain) fails to check that the calling process is:
  1) not sandboxed 
  2) is the same process as the one specified through `pid`

As a result, a sandboxed, low privilege process could add an XPC service or helper to the process domain of an unsandboxed root process, e.g. wifivelocityd, to escape sandbox and elevate privileges from user to root. The exploit does this by adding an XPC service that listens on a port to the process domain of wifivelocityd. Once registered, a socket is opened to the port which launches the XPC service as root.

This bug was initially partially patched by implementing a sandbox check. However, up until the Catalina February 2021 update, you could still use it for unsandboxed user -> root privilege escalation. This is because check #2 was still missing. In fact, the update to fully patch the bug did not implement the check (which, by the way, is defined by the launchd man page) and you are still able to register a bundle in the process domain of a different process. However, the bundle will no longer be launched with the euid of the process domain, rather the euid of the process that registered the bundle.
